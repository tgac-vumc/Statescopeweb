"use strict";(self.webpackChunkStatescope=self.webpackChunkStatescope||[]).push([[9228],{7633:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"python","title":"Python tutorial for Statescope","description":"In this tutorial, we will walk through setting up and running the Statescope package in Python for bulk data analysis. We will cover installation, environment setup, data import, deconvolution, refinement, and cell state discovery.","source":"@site/docs/python.md","sourceDirName":".","slug":"/python","permalink":"/Statescopeweb/docs/python","draft":false,"unlisted":false,"editUrl":"https://github.com/tgac-vumc/Statescopeweb.git/docs/python.md","tags":[],"version":"current","frontMatter":{"id":"python","title":"Python tutorial for Statescope"},"sidebar":"tutorialSidebar","previous":{"title":"Input Arguments","permalink":"/Statescopeweb/docs/input"},"next":{"title":"Advanced Tutorial Python","permalink":"/Statescopeweb/docs/advanced-tutorial_python"}}');var i=t(4848),o=t(8453);const a={id:"python",title:"Python tutorial for Statescope"},r="Statescope Tutorial",l={},c=[{value:"1. Installation",id:"1-installation",level:2},{value:"2. Importing Dependencies",id:"2-importing-dependencies",level:2},{value:"3. Loading Your Bulk Data",id:"3-loading-your-bulk-data",level:2},{value:"4. Initializing Statescope",id:"4-initializing-statescope",level:2},{value:"5. Deconvolution",id:"5-deconvolution",level:2},{value:"6. Refinement",id:"6-refinement",level:2},{value:"7. Cell State Discovery",id:"7-cell-state-discovery",level:2},{value:"8. Visualization",id:"8-visualization",level:2},{value:"8.1 Visualizing Fractions",id:"81-visualizing-fractions",level:3},{value:"8.2 Visualizing Purified Gene Expression Profiles",id:"82-visualizing-purified-gene-expression-profiles",level:3},{value:"8.3 Visualizing Top Genes Per Cell State",id:"83-visualizing-top-genes-per-cell-state",level:3},{value:"9. Summary",id:"9-summary",level:2},{value:"10. Saving, Loading, and CPU/GPU Interoperability",id:"10-saving-loading-and-cpugpu-interoperability",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"statescope-tutorial",children:"Statescope Tutorial"})}),"\n",(0,i.jsxs)(n.p,{children:["In this tutorial, we will walk through setting up and running the ",(0,i.jsx)(n.strong,{children:"Statescope"})," package in Python for bulk data analysis. We will cover installation, environment setup, data import, deconvolution, refinement, and cell state discovery."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-installation",children:"1. Installation"}),"\n",(0,i.jsxs)(n.p,{children:["Please follow the ",(0,i.jsx)(n.a,{href:"/Statescopeweb/docs/installation",children:"Installation Steps"})," and create or activate your conda environment:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"conda create -n statescope_env python=3.8\nconda activate statescope_env\n"})}),"\n",(0,i.jsx)(n.p,{children:"Make sure you have the necessary dependencies installed before proceeding."}),"\n",(0,i.jsx)(n.h2,{id:"2-importing-dependencies",children:"2. Importing Dependencies"}),"\n",(0,i.jsx)(n.p,{children:"Below is an example of how you might structure your imports within a Python script or Jupyter notebook. Adjust paths and filenames as needed."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import Statescope.Statescope\nfrom Statescope.Statescope import Initialize_Statescope\nimport pandas as pd\nimport pickle\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-loading-your-bulk-data",children:"3. Loading Your Bulk Data"}),"\n",(0,i.jsx)(n.p,{children:"For this tutorial, we\u2019ll demonstrate using test data from a GitHub repository.\nReplace the URL below with your own bulk data source as needed."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Example test dataset (subset of transcriptome data)\nBulk = pd.read_csv(\n    'https://github.com/tgac-vumc/OncoBLADE/raw/refs/heads/main/data/Transcriptome_matrix_subset.txt',\n    sep='\\t',\n    index_col='symbol'\n)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For loading your own Bulk RNA-seq data check the input requirements for the dataset on the ",(0,i.jsx)(n.a,{href:"/Statescopeweb/docs/input",children:"Input Requirements"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-initializing-statescope",children:"4. Initializing Statescope"}),"\n",(0,i.jsx)(n.p,{children:"Choose an appropriate tumor or tissue type. Currently supported options include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"NSCLC"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PDAC"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PBMC"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["More details about the pre-processed scRNA references present in ",(0,i.jsx)(n.a,{href:"/Statescopeweb/docs/processed-signatures",children:"Processed Signature Datasets"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"Statescope_model = Initialize_Statescope(Bulk, TumorType='NSCLC')\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For providing your own scRNA-seq dataset check ",(0,i.jsx)(n.a,{href:"/Statescopeweb/docs/input",children:"Input Requirements"})," for the correct format."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import scanpy as sc \nfile_path = 'scRNA.h5ad' ###scRNA data should be in h5ad format\nSignature = sc.read_h5ad(file_path)\nStatescope_model = Initialize_Statescope(Bulk, Signature = Signature, celltype_key= 'celltype_key', Ncores = 40) ####Specify celltype_key in the adata.obs\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-deconvolution",children:"5. Deconvolution"}),"\n",(0,i.jsx)(n.p,{children:"Deconvolution is used to estimate cell-type-specific expression from bulk data."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"Statescope_model.Deconvolution()\n"})}),"\n",(0,i.jsx)(n.p,{children:"After deconvolution, you can extract the fractions of each gene across different cell types using:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"Fractions = Statescope_model.Fractions  # shape: [N_genes x N_cell_types]\nprint(Fractions.head())\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-refinement",children:"6. Refinement"}),"\n",(0,i.jsx)(n.p,{children:"Refinement is performed to improve the estimation of cell-type-specific gene expression profiles."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"Statescope_model.Refinement()\n\n# You can run the refinement multiple times if desired\nStatescope_model.Refinement()\n"})}),"\n",(0,i.jsx)(n.p,{children:"The refined gene expression profiles for each cell type can be accessed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from Statescope import Extract_GEX\n##Gene expression of the cell type you want to extract \nExtract_GEX(Statescope_model, 'Celltype')\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-cell-state-discovery",children:"7. Cell State Discovery"}),"\n",(0,i.jsx)(n.p,{children:"To discover potential sub-states or subpopulations within each cell type, run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"Statescope_model.StateDiscovery()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After running state discovery, you can extract information about the discovered sub-states (loadings, etc.) from the model. The specific attributes and methods will depend on how ",(0,i.jsx)(n.strong,{children:"Statescope"})," organizes its results. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from Statescope import Extract_StateLoadings\nExtract_StateLoadings(Statescope_model)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"(Make sure to check the Statescope documentation for more details on these attributes.)"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"8-visualization",children:"8. Visualization"}),"\n",(0,i.jsx)(n.h3,{id:"81-visualizing-fractions",children:"8.1 Visualizing Fractions"}),"\n",(0,i.jsx)(n.p,{children:"To quickly visualize the fraction matrix, you can use a heatmap function provided by Statescope:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from Statescope import Heatmap_Fractions\n\nHeatmap_Fractions(Statescope_model)\n"})}),"\n",(0,i.jsx)(n.p,{children:"This generates a heatmap of the cell-type fractions or scores across genes (or samples, depending on how your data is organized)."}),"\n",(0,i.jsx)(n.h3,{id:"82-visualizing-purified-gene-expression-profiles",children:"8.2 Visualizing Purified Gene Expression Profiles"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from Statescope import Heatmap_GEX\n\nHeatmap_GEX(Statescope_model, 'Cell Type')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"83-visualizing-top-genes-per-cell-state",children:"8.3 Visualizing Top Genes Per Cell State"}),"\n",(0,i.jsx)(n.p,{children:"You can choose how many genes per state to be visualised in the Bar plot using the top_genes argument"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from Statescope import BarPlot_StateLoadings\n# Example Usage\nBarPlot_StateLoadings(Statescope_model, top_genes=1)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"9-summary",children:"9. Summary"}),"\n",(0,i.jsx)(n.p,{children:"By following these steps, you will:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Install"})," and ",(0,i.jsx)(n.strong,{children:"set up"})," your environment."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Load"})," your bulk data (or use the provided test dataset)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Initialize"})," Statescope with the appropriate ",(0,i.jsx)(n.code,{children:"TumorType"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Perform Deconvolution"})," to estimate cell-type fractions."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Refine"})," those estimates for improved accuracy."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Discover"})," sub-states (cell state discovery)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Visualize"})," your results through heatmaps and other methods."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Feel free to adjust the code to fit your data structure, directory organization, or specific analysis needs. For more advanced usage, please consult the official Statescope documentation or check additional examples in the repository."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"10-saving-loading-and-cpugpu-interoperability",children:"10. Saving, Loading, and CPU/GPU Interoperability"}),"\n",(0,i.jsxs)(n.p,{children:["Statescope models are not fully portable when using ",(0,i.jsx)(n.code,{children:"pickle.load"}),". Use the built-in ",(0,i.jsx)(n.code,{children:"Statescope.load()"})," and ",(0,i.jsx)(n.code,{children:"model.save()"})," helpers for CPU/GPU interoperability."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'model = Statescope.load(\n    "/net/beegfs/users/P094398/StatescopeBenchmark/Benchmark/Data/Alldone.pkl",\n    device="cpu",\n)\n\nmodel.StateDiscovery()\nmodel.EcotypeDiscovery()\n\n# Save the model; if you ran on GPU, you can save it for CPU use like this\nmodel.save(\n    "/net/beegfs/users/P094398/Deployed_Dec/tutorial/Output/AllFinal_PBMC5.pkl",\n    to_cpu=True,\n)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Notes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:'device="cpu"'})," when opening on CPU, and ",(0,i.jsx)(n.code,{children:'device="cuda"'})," when opening on GPU."]}),"\n",(0,i.jsx)(n.li,{children:"It is recommended to save your model after each module (e.g., after deconvolution, refinement, and state discovery)."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);